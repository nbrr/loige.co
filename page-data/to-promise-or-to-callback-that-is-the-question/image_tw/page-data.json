{"componentChunkName":"component---src-templates-blog-post-share-image-js","path":"/to-promise-or-to-callback-that-is-the-question/image_tw","result":{"data":{"site":{"siteMetadata":{"title":"Luciano Mammino \"Loige\" - Cloud developer, entrepreneur, fighter, butterfly maker!","author":"Luciano Mammino","siteUrl":"https://loige.co","twitterProfile":"loige","disqusShortName":"loige"}},"markdownRemark":{"id":"98a8f1b8-6627-5694-94c1-b83fbd6c6799","timeToRead":6,"headings":[{"value":"The problem","depth":2},{"value":"1. The “I don’t fu**in’ care” approach","depth":2},{"value":"2. The “No strong feelings” way","depth":2},{"value":"A little caveat and an alternative implementation","depth":3},{"value":"Conclusion","depth":2}],"html":"<p>You are building the next cool <a href=\"/tag/javascript\">JavaScript</a> or <a href=\"/tag/node-js\">Node.js</a> module with a lot of asynchronous functions and you are very happy about it. At some point a terrible doubt assaults you:</p>\n<blockquote>\n<p>Should my API offer support for callbacks or should it be promise based?</p>\n</blockquote>\n<p>In this article we are going to show a very simple way to add support for both promises and callbacks in our asynchronous modules, this way we can make everyone happy and our libraries much more flexible.</p>\n<h2 id=\"the-problem\" style=\"position:relative;\"><a href=\"#the-problem\" aria-label=\"the problem permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The problem</h2>\n<p>Promises can be used as a nice replacement for callbacks, that’s a well know fact in the JavaScript world today. Promises turn out to be very useful in making our code more readable and easy to reason about.\nBut while promises bring many advantages, they also require the developer to understand many non-trivial concepts in order to use them correctly and proficiently. For this and other reasons, in some cases it might be more practical to prefer callbacks over promises.</p>\n<p>Now let’s imagine for a moment that we want to build a public library that performs asynchronous operations. What do we do? Do we create a <em>callback oriented</em> API or a <em>promise oriented</em> one? Do we need to be opinionated on one side or another or there are ways to support both and make everyone happy?</p>\n<p>There are at least 2 approaches to face this question, let’s see how they work!</p>\n<h2 id=\"1-the-i-dont-fuin-care-approach\" style=\"position:relative;\"><a href=\"#1-the-i-dont-fuin-care-approach\" aria-label=\"1 the i dont fuin care approach permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. The “I don’t fu**in’ care” approach</h2>\n<p><img src=\"http://i.giphy.com/on45FojvYvnsQ.gif\" alt=\"I don&#x27;t care gif animation Judy Garland\"></p>\n<p>The first approach, used for instance by libraries like <a href=\"https://www.npmjs.com/package/request\">request</a>, <a href=\"https://www.npmjs.com/package/redis\">redis</a> and <a href=\"https://www.npmjs.com/package/mysql\">mysql</a> as well as all the node native async functions, consists in offering a simple API based only on callbacks and leave the developer the option to <em>promisify</em> the exposed functions if needed.\nSome of these libraries are a bit more elaborated and they provide helpers to be able to <em>promisify</em> all the asynchronous functions they offer at once, but the developer still needs to someway “convert” the exposed API to be able to use promises.\nThat’s why I believe this approach feels a bit rude like:</p>\n<blockquote>\n<p>Do you want to use Promise? I don’t care, it’s your problem… just promisify what you want and leave me alone!</p>\n</blockquote>\n<p>There are a number of modules out there that can help to promisify a callback based function. The first two that come in my mind are <a href=\"http://bluebirdjs.com/\">Bluebird</a> with its <a href=\"http://bluebirdjs.com/docs/api/promise.promisify.html\"><code>Promise.promisify()</code></a> method and <a href=\"https://www.npmjs.com/package/es6-promisify\">es6-promisify</a> which adopts ES2015 promises.</p>\n<p>Let’s see a quick example of this approach with <strong>es6-promisify</strong>. In the following snippet of code we are going to promisify the native <code>fs.readFile()</code> function:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token string\">'use strict'</span>\n\n<span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> promisify <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'es6-promisify'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">let</span> readFile <span class=\"token operator\">=</span> <span class=\"token function\">promisify</span><span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">.</span>readFile<span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">readFile</span><span class=\"token punctuation\">(</span><span class=\"token string\">'last_action_hero.txt'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">content</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>The example is very straightforward, we just have to call <code>promisify(fs.readFile)</code> to obtain a promisified version of the <code>readFile</code> function. As we might expect we can invoke this function without passing the <code>callback</code> argument and we get a <code>Promise</code> object as output, so we can immediately use it and call the handy <code>then</code> and <code>catch</code> methods.</p>\n<p>Unfortunately the new <code>Promise</code> implementation of ES2015 does not offer a built-in <em>promisify</em> mechanism (yet…).</p>\n<h2 id=\"2-the-no-strong-feelings-way\" style=\"position:relative;\"><a href=\"#2-the-no-strong-feelings-way\" aria-label=\"2 the no strong feelings way permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. The “No strong feelings” way</h2>\n<p><img src=\"http://i.giphy.com/7U7oEJkAiP5Xq.gif\" alt=\"I have no strong feeling either way futurama gif animation\"></p>\n<p>This approach is more transparent and I would say more… “polite”!\nIt is also based on the concept of offering a simple callback oriented API, but <strong>it makes the callback argument optional</strong>.\nWhenever the callback is passed as an argument the function will behave normally executing the callback on completion or on failure. Instead <strong>when the callback is not passed to the function, it will immediately return a Promise object</strong>.</p>\n<p>This approach effectively combines callbacks and promises in a way that allows the developer to choose at call time what interface to adopt, without any need to promisify the function in advance. Many libraries like <a href=\"https://www.npmjs.com/package/mongoose\">mongoose</a> and <a href=\"https://www.npmjs.com/package/sequelize\">sequelize</a> are supporting this approach.</p>\n<p>Let’s see a simple implementation of this approach with an example. Let’s assume we want to implement a dummy module that executes divisions asynchronously:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">module<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token function\">asyncDivision</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">dividend<span class=\"token punctuation\">,</span> divisor<span class=\"token punctuation\">,</span> cb</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// [1]</span>\n\n    process<span class=\"token punctuation\">.</span><span class=\"token function\">nextTick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>\n        <span class=\"token keyword\">typeof</span> dividend <span class=\"token operator\">!==</span> <span class=\"token string\">'number'</span> <span class=\"token operator\">||</span>\n        <span class=\"token keyword\">typeof</span> divisor <span class=\"token operator\">!==</span> <span class=\"token string\">'number'</span> <span class=\"token operator\">||</span>\n        divisor <span class=\"token operator\">===</span> <span class=\"token number\">0</span>\n      <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> error <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Invalid operands'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cb<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span> <span class=\"token function\">cb</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token comment\">// [2]</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token keyword\">var</span> result <span class=\"token operator\">=</span> dividend <span class=\"token operator\">/</span> divisor\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cb<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">cb</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token comment\">// [3]</span>\n      <span class=\"token keyword\">return</span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The code of the module is very simple, but there are some details (marked with a number in square brackets) that are worth to be underlined:</p>\n<ol>\n<li>First, we return a new promise created using the ES2015 <code>Promise</code> constructor. We define the whole logic inside the function passed as argument to the constructor.</li>\n<li>In case of error, we reject the promise, but if the callback was passed at call time we also execute the callback to propagate the error.</li>\n<li>After we calculate the result we resolve the promise, but again, if there’s a callback, we propagate the result to the callback as well.</li>\n</ol>\n<p>Now to complete the example, let’s see now how we can use this module with both callbacks and promises:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// callback oriented usage</span>\n<span class=\"token function\">asyncDivision</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">error<span class=\"token punctuation\">,</span> result</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// promise oriented usage</span>\n<span class=\"token function\">asyncDivision</span><span class=\"token punctuation\">(</span><span class=\"token number\">22</span><span class=\"token punctuation\">,</span> <span class=\"token number\">11</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>It should be clear that with very little effort, the developers who are going to use our new module will be able to easily choose the style that best suits their needs without having to introduce an external “promisification” function whenever they want to leverage promises.</p>\n<h3 id=\"a-little-caveat-and-an-alternative-implementation\" style=\"position:relative;\"><a href=\"#a-little-caveat-and-an-alternative-implementation\" aria-label=\"a little caveat and an alternative implementation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>A little caveat and an alternative implementation</h3>\n<p>As <a href=\"https://disqus.com/by/amar_zavery\">Amar Zavery</a> pointed out in a <a href=\"//loige.co/to-promise-or-to-callback-that-is-the-question/#comment-3184972856\">comment here</a>, this approach is not perfect.</p>\n<p>If we use the function with the callback approach, we still have created and returned a promise that behaves in an inconsistent way (never <em>resolved</em>, nor <em>rejected</em>). Let’s make this clear with an example:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">asyncDivision</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> console<span class=\"token punctuation\">.</span>log<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Promise resolved</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Promise rejected</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>In this example, we are passing a callback (<code>console.log</code>) to our function but also using the returned promise to print some extra information.\nWith our implementation of <code>asyncDivision</code> either the <code>then</code> block and the <code>catch</code> block are never executed because the function is interrupted as soon as the callback is used.</p>\n<p>This is most of the time negligible because is very unlikely that somebody will be using the function with this mixed async approach (we could even argue that doing so would be a bad practice).</p>\n<p>Anyway, we can get rid of this issue by re-implementing our async function as follows:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">module<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token function\">asyncDivision</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">dividend<span class=\"token punctuation\">,</span> divisor<span class=\"token punctuation\">,</span> cb</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// internal implementation, callback based</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">_asyncDivision</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">dividend<span class=\"token punctuation\">,</span> divisor<span class=\"token punctuation\">,</span> cb</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    process<span class=\"token punctuation\">.</span><span class=\"token function\">nextTick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>\n        <span class=\"token keyword\">typeof</span> dividend <span class=\"token operator\">!==</span> <span class=\"token string\">'number'</span> <span class=\"token operator\">||</span>\n        <span class=\"token keyword\">typeof</span> divisor <span class=\"token operator\">!==</span> <span class=\"token string\">'number'</span> <span class=\"token operator\">||</span>\n        divisor <span class=\"token operator\">===</span> <span class=\"token number\">0</span>\n      <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">cb</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Invalid operands'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token keyword\">return</span> <span class=\"token function\">cb</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> dividend <span class=\"token operator\">/</span> divisor<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cb<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">_asyncDivision</span><span class=\"token punctuation\">(</span>dividend<span class=\"token punctuation\">,</span> divisor<span class=\"token punctuation\">,</span> cb<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// optional promisification, only if no callback</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n    <span class=\"token function\">_asyncDivision</span><span class=\"token punctuation\">(</span>\n      dividend<span class=\"token punctuation\">,</span>\n      divisor<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> result</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>err <span class=\"token operator\">?</span> <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This code generates a promise only if no callback is used. So if we provide a callback as the last argument, and then we try to use <code>catch</code> or <code>then</code> on the returning value, we will get an explicit runtime error:</p>\n<ul>\n<li><code>TypeError: Cannot read property 'then' of undefined</code> or</li>\n<li><code>TypeError: Cannot read property 'catch' of undefined</code></li>\n</ul>\n<p>While this approach is probably more correct, it is also more verbose and, if it becomes a recurrent practice in your development process, you are better off using some promisification library.</p>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>As usual I hope this article has been useful and that it will ignite some interesting conversation.</p>\n<p>I think from the tone of the article it’s quite clear that I prefer to opt for the “polite” approach, but I am very curious to know what are your opinions about this topic and if you are an “I don’t care” or a “whatever” person when you create your asynchronous functions in your modules.</p>\n<p>Let me know your thoughts in the comments.</p>\n<p>Until next time! :)</p>","frontmatter":{"title":"To promise or to callback? That is the question...","slug":"to-promise-or-to-callback-that-is-the-question","author":"Luciano Mammino","tags":["javascript","node-js"],"date":"February 14, 2016","header_img":{"publicURL":"/static/4526d78f263c67ec0e757c66256e7608/to-promise-or-to-callback-this-is-the-problem-loige-amlet-arnold-schwarzenegger-javascript.jpg"}}}},"pageContext":{"slug":"to-promise-or-to-callback-that-is-the-question","width":440,"height":220,"type":"twitter"}},"staticQueryHashes":[]}