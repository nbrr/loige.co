{"componentChunkName":"component---src-templates-blog-post-share-image-js","path":"/simple-echo-server-written-in-go-dockerized/image_tw","result":{"data":{"site":{"siteMetadata":{"title":"Luciano Mammino \"Loige\" - Cloud developer, entrepreneur, fighter, butterfly maker!","author":"Luciano Mammino","siteUrl":"https://loige.co","twitterProfile":"loige","disqusShortName":"loige"}},"markdownRemark":{"id":"a0bda160-b42a-581d-ba80-5ca4283aa173","timeToRead":9,"headings":[{"value":"Introduction","depth":2},{"value":"The Go echo server","depth":2},{"value":"Dockerizing the application","depth":2},{"value":"Images, Containers and Dockerfile(s)","depth":3},{"value":"Let’s write the Dockerfile","depth":3},{"value":"Let’s build!","depth":3},{"value":"Running the container","depth":3},{"value":"Conclusions","depth":2}],"html":"<p>In this post we will see how to write a (very) simple <strong>Go server app</strong> and how to put it into a <strong>Docker container</strong> and run it.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 780px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAACdElEQVQoz2NgYjBiYjCGIDZmMy5OK34+eyEBRxFhVylpb2lZH2lpb0lJT1FRVwF+B24uazYWc2ZGE4h6BmYGCyYGSyBiYbLm4nAQ4HcVFfFSUAzT0ktUUY5RU4xTVY9XUomVkwuXkAgSEvLh4XJhZbaBaAFqtmVisAMidlZnXl4vYaEAaaXYquVb2/eeNPatN/SrNdAv1dHOV1NMkZNPkJCIEuAP4GB3YWa0B2oBanZgYnBkZnLi5PAU4A8UF49WVkrO2H3Oa81ereY5euXTLYzqjQP7Nd3blJUypKTihQRDuDi9WJhcmBgcgJodmRicWZncuDl9hITCpKWT1DTyTGvn6U7fqDVpje6k1Rap0/Wbd8p1btXQKVVWLpaSSePnC2FjcWdicIJpZnbj5vITEo6Uk0rVsK4UXHhKYMU1qWUXRVdeF9h4W7F2jbFJna5hu47JRAXVGhHxVG7uICZGF2SbfYUEI2Rl0pUUi50K5hUfviK07CzDtCOSpSvNbHoMDDq0dJtVNOolJDMFBWN5+SJYWTwgfnZiZnThZPcS4A+RlEhQVMzTUyv18+019O7Vd2w30ak30GvS1q1RVi6UlkoVEgwHWsPG6sXE6AwJbXug/eysrrw8vmKi4WKiMdHZ84t79qQXryzr2FHctTM4caaSUpacXLKYWCQfnz8HmxszI9BKe6BmYIxZMzHYsDDZcXG4CPB7CwsHWDqVeUd2eoS3e0W0+8f3mlgVyshESkiECAr4cnO5sTED4wkY1dYMTAzA5GIKRMwMZuwsFtxctgL8zoL8zkKCrmKiHuJinqIiIFJMzENQwJmHC5gcLJkZzcBaTAAtQ4hVexohvQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/2e48989905f3733e68742c36cee8353e/8d3d1/dockerize-go-app.webp 256w,\n/static/2e48989905f3733e68742c36cee8353e/354cf/dockerize-go-app.webp 512w,\n/static/2e48989905f3733e68742c36cee8353e/8fabf/dockerize-go-app.webp 780w\"\n          sizes=\"(max-width: 780px) 100vw, 780px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/2e48989905f3733e68742c36cee8353e/85b06/dockerize-go-app.png 256w,\n/static/2e48989905f3733e68742c36cee8353e/bc282/dockerize-go-app.png 512w,\n/static/2e48989905f3733e68742c36cee8353e/f4d8b/dockerize-go-app.png 780w\"\n          sizes=\"(max-width: 780px) 100vw, 780px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/2e48989905f3733e68742c36cee8353e/f4d8b/dockerize-go-app.png\"\n          alt=\"Dockerize a Go application\"\n          title=\"Dockerize a Go application\"\n          loading=\"lazy\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        />\n      </picture>\n    </span></p>\n<p><strong>Disclaimer</strong>: I’m an absolute beginner with both <a href=\"http://golang.org\">Go</a> and <a href=\"https://docker.com\">Docker</a> and this is just an experiment I did to start to explore this two interesting technologies. If you’ll find something weird or wrong you are <strong>very</strong> encouraged to scream at me in the comments (<a href=\"#disqus_thread\">Comments</a>), I will be extremely thankful ;)</p>\n<h2 id=\"introduction\" style=\"position:relative;\"><a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introduction</h2>\n<p>We are going to write a simple echo server in Go and then we will pack it into a Docker container for future execution/distribution.</p>\n<p><em>“Luciano, you are a PHP developer, why bothering with Go?”</em></p>\n<p>Nice question! Well, there are at least two reasons for this choice:</p>\n<ul>\n<li><strong>Experimenting</strong>! Yes Go seems to be the next cool thing in the field and I wanted to have an excuse to try it.</li>\n<li><strong>Simplicity</strong>! Writing a server app in Go is just a matter of writing few lines of code in a file, so it’s an very simple scenario to test the integration with Docker.</li>\n</ul>\n<p>For those who are not familiar with these two technologies I suggest give the official websites a shot (<a href=\"https://docker.com\">Docker.com</a> and <a href=\"http://golang.org\">Golang.org</a>) as I will not provide many specific details about them.\nI assume you have both technologies installed on your machine. If you are using Windows or a Mac have a look at <a href=\"https://github.com/boot2docker/boot2docker\">Boot2Docker</a>, it will definitely make your life easier.</p>\n<p>Beware that Go on your local machine is needed only if you want to test the application before “dockerizing” it. We will put the Go runtime into the Docker container in the second part of the post and this way we will be able to execute it without having Go installed in our local machine (that’s infact the real advantage of using Docker).</p>\n<h2 id=\"the-go-echo-server\" style=\"position:relative;\"><a href=\"#the-go-echo-server\" aria-label=\"the go echo server permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The Go echo server</h2>\n<p>Ok, first of all let’s write and test our server app. The app should open a socket and listen for TCP requests on a given port. Then when it receives some data it should reply by saying something like that <em>“Hi, I received your message! It was X bytes long and that’s what it said: XXX ! Honestly I have no clue about what to do with your messages, so Bye Bye!”</em>.</p>\n<p>So let’s just write some code. The following script has been widely inspired by <a href=\"https://coderwall.com/p/wohavg\">this one</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token comment\">//server.go</span>\n\n<span class=\"token keyword\">package</span> main\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"fmt\"</span>\n    <span class=\"token string\">\"net\"</span>\n    <span class=\"token string\">\"os\"</span>\n    <span class=\"token string\">\"strconv\"</span>\n    <span class=\"token string\">\"bytes\"</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">(</span>\n    CONN_HOST <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span>\n    CONN_PORT <span class=\"token operator\">=</span> <span class=\"token string\">\"3333\"</span>\n    CONN_TYPE <span class=\"token operator\">=</span> <span class=\"token string\">\"tcp\"</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Listen for incoming connections.</span>\n    l<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> net<span class=\"token punctuation\">.</span><span class=\"token function\">Listen</span><span class=\"token punctuation\">(</span>CONN_TYPE<span class=\"token punctuation\">,</span> <span class=\"token string\">\":\"</span><span class=\"token operator\">+</span>CONN_PORT<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Error listening:\"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">.</span><span class=\"token function\">Error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        os<span class=\"token punctuation\">.</span><span class=\"token function\">Exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// Close the listener when the application closes.</span>\n    <span class=\"token keyword\">defer</span> l<span class=\"token punctuation\">.</span><span class=\"token function\">Close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Listening on \"</span> <span class=\"token operator\">+</span> CONN_HOST <span class=\"token operator\">+</span> <span class=\"token string\">\":\"</span> <span class=\"token operator\">+</span> CONN_PORT<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Listen for an incoming connection.</span>\n        conn<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> l<span class=\"token punctuation\">.</span><span class=\"token function\">Accept</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n            fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Error accepting: \"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">.</span><span class=\"token function\">Error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            os<span class=\"token punctuation\">.</span><span class=\"token function\">Exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">//logs an incoming message</span>\n        fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Received message %s -> %s \\n\"</span><span class=\"token punctuation\">,</span> conn<span class=\"token punctuation\">.</span><span class=\"token function\">RemoteAddr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> conn<span class=\"token punctuation\">.</span><span class=\"token function\">LocalAddr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token comment\">// Handle connections in a new goroutine.</span>\n        <span class=\"token keyword\">go</span> <span class=\"token function\">handleRequest</span><span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Handles incoming requests.</span>\n<span class=\"token keyword\">func</span> <span class=\"token function\">handleRequest</span><span class=\"token punctuation\">(</span>conn net<span class=\"token punctuation\">.</span>Conn<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Make a buffer to hold incoming data.</span>\n  buf <span class=\"token operator\">:=</span> <span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1024</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// Read the incoming connection into the buffer.</span>\n  reqLen<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> conn<span class=\"token punctuation\">.</span><span class=\"token function\">Read</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n    fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Error reading:\"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">.</span><span class=\"token function\">Error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// Builds the message.</span>\n  message <span class=\"token operator\">:=</span> <span class=\"token string\">\"Hi, I received your message! It was \"</span>\n  message <span class=\"token operator\">+=</span> strconv<span class=\"token punctuation\">.</span><span class=\"token function\">Itoa</span><span class=\"token punctuation\">(</span>reqLen<span class=\"token punctuation\">)</span>\n  message <span class=\"token operator\">+=</span> <span class=\"token string\">\" bytes long and that's what it said: \\\"\"</span>\n  n <span class=\"token operator\">:=</span> bytes<span class=\"token punctuation\">.</span><span class=\"token function\">Index</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">{</span><span class=\"token number\">0</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  message <span class=\"token operator\">+=</span> <span class=\"token function\">string</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span>n<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  message <span class=\"token operator\">+=</span> <span class=\"token string\">\"\\\" ! Honestly I have no clue about what to do with your messages, so Bye Bye!\\n\"</span>\n\n  <span class=\"token comment\">// Write the message in the connection channel.</span>\n  conn<span class=\"token punctuation\">.</span><span class=\"token function\">Write</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token function\">byte</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// Close the connection when you're done with it.</span>\n  conn<span class=\"token punctuation\">.</span><span class=\"token function\">Close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Ok, the code is commented at it should be understandable enough.\nLet’s try if it works.</p>\n<p>Just launch the server with the command:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">go run server.go</code></pre></div>\n<p>We will have our server running and it will print out something like:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">Listening on :3333</code></pre></div>\n<p>Let’s open another terminal window to try to speak with him. We will use <a href=\"http://wikipedia.org/wiki/Netcat\">netcat</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Hello server\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">nc</span> localhost <span class=\"token number\">3333</span></code></pre></div>\n<p>That’s what we should see in the two terminal windows:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 699px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.671875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAACCklEQVQoz42SXW/SYBTHnyujMcEb2HgR0NLSlgYKLWSDFmpBN5GEG0IguAXW8fJJ5pXjRu5mNKLBlZeB1zPhO3A7t9AugWu+gQfQ2W03/vLk5DTnf07POc+DFouFrumz2Ww+n68tcKVdX15e6fq1pmm6rk+n0/lt1kqkdk8Z1ifGBVGMAwIgCjFBiMbACNHo9pqYAVEUOY6rVqvoe7fjj1IJOZ6UU5DM81yQZwOBwNb2FsuyGPYcuweO4zabLZfLoU6nQxIUz4ehGMMwbID1+/00TUM+WIIgvPegKMrpdBYKBdRut602K0mSa92N+k4aaQCKulyuv8lWK4Q9BvC7GIMeqGu32/P5PLr4daGqp8Ph8MeK0WgERu2fqd1uv9/v9XpgwBkZANlgMBiPx+j8/Ofe2/16vV6r1apLauCXK0q5XDlUlOU5VA6Ugz+BFY1Go1KpHB29Q5+/fHrieEz6YBIfAMNiOOajadgKzAZNegkvhJY+5nE4HDCt2+02m83ZbBb1z3q8yO68fpV5k9nd2U2n05IsSQlJkl7IsiwlEslkKpV6GY8nZDkJ185xoXAkArVKpRL61vn6zPc0xAd5jo+EI8FQkGYoI9AESCmShL4oioTVwhf8v1gsopOTjw8fPIKFm1dYLJaNf2xu3GZzBbwQk8mUyWTQZDI5Pn7farU+/DcgbjabcAW/AXTBBGcEwfxsAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/222fd6ab40d3dd443178d05cb5270cf7/8d3d1/go-server-output.webp 256w,\n/static/222fd6ab40d3dd443178d05cb5270cf7/354cf/go-server-output.webp 512w,\n/static/222fd6ab40d3dd443178d05cb5270cf7/179fa/go-server-output.webp 699w\"\n          sizes=\"(max-width: 699px) 100vw, 699px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/222fd6ab40d3dd443178d05cb5270cf7/85b06/go-server-output.png 256w,\n/static/222fd6ab40d3dd443178d05cb5270cf7/bc282/go-server-output.png 512w,\n/static/222fd6ab40d3dd443178d05cb5270cf7/0f854/go-server-output.png 699w\"\n          sizes=\"(max-width: 699px) 100vw, 699px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/222fd6ab40d3dd443178d05cb5270cf7/0f854/go-server-output.png\"\n          alt=\"Go echo server terminal windows execution\"\n          title=\"Go echo server terminal windows execution\"\n          loading=\"lazy\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        />\n      </picture>\n    </span></p>\n<p>The terminal window on the top is running our server and it logs all the received requests (by printing the incoming TCP address and the local one), while the second terminal is our client that sent out a simple “Hello server” message and received a <em>very useful</em> response from the server.</p>\n<p>That’s all from the Go side. In the next part of the post we will see how to “dockerize” this simple Go app. For now, you can obviously quit the server with a <code>CTRL+C</code>.</p>\n<h2 id=\"dockerizing-the-application\" style=\"position:relative;\"><a href=\"#dockerizing-the-application\" aria-label=\"dockerizing the application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dockerizing the application</h2>\n<p>Ok, now we want to <em>“dockerize”</em> this simple application. Wait, what does <em>“dockerize”</em> mean? Well, by <em>“dockerizing”</em> an application we will be able to put the application itself and all its dependencies within a Docker container that can be easily shipped and executed elsewhere.</p>\n<h3 id=\"images-containers-and-dockerfiles\" style=\"position:relative;\"><a href=\"#images-containers-and-dockerfiles\" aria-label=\"images containers and dockerfiles permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Images, Containers and Dockerfile(s)</h3>\n<p>An extract from the Docker documentation should make things a bit clearer:</p>\n<blockquote>\n<p>Docker enables apps to be quickly assembled from components and eliminates the friction between development, QA, and production environments. As a result, IT can ship faster and run the same app, unchanged, on laptops, data center VMs, and any cloud.</p>\n</blockquote>\n<p>There are several ways to dockerize an application and create a dedicated Docker container. The one I prefer at the moment is by adopting a ”<em>Dockerfile</em>“.</p>\n<p>A ”<em>Dockerfile</em>” is a file called exactly <code>Dockerfile</code> that contains several reproducible instructions to create a Docker <em>image</em> from scratch.</p>\n<p><em>What the hell is an image and how it is different from a container?</em></p>\n<p>If you are a noob with Docker (like me) you are probably asking yourself this question. I want to quote a <a href=\"http://stackoverflow.com/a/21499102/495177\">brilliant answer from stackoverflow</a> that should make things a bit clearer:</p>\n<blockquote>\n<p>An image is the set of layers that are built up and can be moved around. Images are read-only.</p>\n<p><a href=\"http://docs.docker.io/en/latest/terms/image/\">http://docs.docker.io/en/latest/terms/image/</a> > <a href=\"http://docs.docker.io/en/latest/terms/layer/\">http://docs.docker.io/en/latest/terms/layer/</a>\nA container is an active (or inactive if exited) stateful instantiation of an image.</p>\n<p><a href=\"http://docs.docker.io/en/latest/terms/container/\">http://docs.docker.io/en/latest/terms/container/</a></p>\n</blockquote>\n<p>Feel free to visit these links if things are not clear yet.</p>\n<p>Now let’s get back to our <code>Dockerfile</code>. Every Dockerfile contains some metadata (base image from which to start, the name of the maintainer, etc.) and a set of instruction used to build the image. These instructions are usually used to “install” all the needed dependencies and describe how to execute the contained application.</p>\n<h3 id=\"lets-write-the-dockerfile\" style=\"position:relative;\"><a href=\"#lets-write-the-dockerfile\" aria-label=\"lets write the dockerfile permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Let’s write the Dockerfile</h3>\n<p>Enough talking, let’s jump to the code:</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token keyword\">FROM</span> ubuntu<span class=\"token punctuation\">:</span>12.04\n\n<span class=\"token keyword\">MAINTAINER</span> Luciano Mammino\n\n<span class=\"token keyword\">RUN</span> apt<span class=\"token punctuation\">-</span>get install <span class=\"token punctuation\">-</span>y python<span class=\"token punctuation\">-</span>software<span class=\"token punctuation\">-</span>properties\n\n<span class=\"token keyword\">RUN</span> add<span class=\"token punctuation\">-</span>apt<span class=\"token punctuation\">-</span>repository ppa<span class=\"token punctuation\">:</span>duh/golang\n<span class=\"token keyword\">RUN</span> apt<span class=\"token punctuation\">-</span>get update\n<span class=\"token keyword\">RUN</span> apt<span class=\"token punctuation\">-</span>get install <span class=\"token punctuation\">-</span>y golang\n\n<span class=\"token keyword\">ADD</span> server.go /var/server/server.go\n\n<span class=\"token keyword\">EXPOSE</span> 3333\n\n<span class=\"token keyword\">CMD</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"go\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"run\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/var/server/server.go\"</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p><strong>Note:</strong> A reader mentioned in a <a href=\"#comment-1881765009\">comment</a> that this dockerfile is no longer working (probably the PPA has beem removed or its temporary unavailable). If that’s your case you can use a minimal dockerfile optimized for GoLang provided by in the <a href=\"https://blog.golang.org/docker#TOC_3.\">GoLang blog</a> itself.</p>\n<p>Let’s analyze all the instructions one by one:</p>\n<ul>\n<li><code>FROM ubuntu:12.04</code> defines the base image from which to start. In this case we will use the <code>ubuntu:12.04</code> image, a very lightweight image based on ubuntu 12.04.</li>\n<li><code>MAINTAINER Luciano Mammino</code> isn’t it self-explanatory enough? ;)</li>\n<li><code>RUN apt-get install -y python-software-properties</code> installs the <code>python-software-properties</code> package to be able to execute <code>add-apt-repository</code> next.</li>\n<li><code>RUN add-apt-repository ppa:duh/golang</code>, <code>RUN apt-get update</code>, <code>RUN apt-get install -y golang</code> and <code>RUN apt-get install -y golang</code>: adds a custom repository for Go and installs it.</li>\n<li><code>ADD server.go /var/server/server.go</code>: copies the file <code>server.go</code> into the image (storing it into the <code>/var/server/</code> folder)</li>\n<li><code>EXPOSE 3333</code>: exposes the port 3333 to allow containers launched from this image to listen on this port. We need exactly this port because it is the one used by our Go application.</li>\n<li><code>CMD [\"go\", \"run\", \"/var/server/server.go\"]</code>: describes the command to execute our Go application when the container is launched (yes, it will execute <code>go run /var/server/server.go</code>).</li>\n</ul>\n<h3 id=\"lets-build\" style=\"position:relative;\"><a href=\"#lets-build\" aria-label=\"lets build permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Let’s build!</h3>\n<p>Before building the image from our Dockerfile, if you are using <code>boot2docker</code>, you need to run it with:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">boot2docker start</code></pre></div>\n<p>In case it prints out something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">2014/06/29 16:09:32 Started.\n2014/06/29 16:09:32 To connect the Docker client to the Docker daemon, please set:\n2014/06/29 16:09:32     export DOCKER_HOST=tcp://192.168.59.103:2375</code></pre></div>\n<p>Run the suggested <code>export</code> command. Also take note of the given IP address as we would need to use later to connect to our server.</p>\n<p>Now just <code>cd</code> into the folder that contains the <code>Dockerfile</code> and the <code>server.go</code> file and run:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker build -t goecho <span class=\"token builtin class-name\">.</span></code></pre></div>\n<p>Notice the <code>.</code> that refers to the current folder (yes you got it, it says Docker to look for a <code>Dockerfile</code> whitin it).</p>\n<p>The <code>-t goecho</code> option is not mandatory and is used to “give a convenience name” to the resulting image.</p>\n<p>You will see a series of commands being executed (yes the ones we wrote within our Dockerfile) and, if everything goes well, you should see something like this at the end:</p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">Successfully built 713c09526bc1</code></pre></div>\n<p>You can also execute</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker images</code></pre></div>\n<p>To list all the available images (you should see our <code>goecho</code> on the top of the list).</p>\n<p>Our image is ready to be run and trasformed into a live container. We’ll see how to do it in the next part of the post.</p>\n<h3 id=\"running-the-container\" style=\"position:relative;\"><a href=\"#running-the-container\" aria-label=\"running the container permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Running the container</h3>\n<p>Running the image and having a live container is just a matter of running:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker run -i -t -p <span class=\"token number\">3333</span>:3333 goecho</code></pre></div>\n<p>The options <code>-i</code> and <code>-t</code> allows us to execute the container into the interactive mode that allows us to shut it down with <code>CTRL+C</code> when needed.</p>\n<p>The option <code>-p 3333:3333</code> maps the container port 3333 to the same port on our machine. It will effectively allows us to talk with the echo server using the port 3333.</p>\n<p>Now our container is live and running and our server application is active.</p>\n<p>Let’s open a new terminal window and try again:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Hello server\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">nc</span> <span class=\"token operator\">&lt;</span>ip<span class=\"token operator\">></span> <span class=\"token number\">3333</span></code></pre></div>\n<p><code>&#x3C;ip></code> is <code>localhost</code> if you are not using <code>boot2docker</code>. If you are using it you need to provide the IP of the intermediade virtual machine provided by <code>boot2docker</code>. It is the one we recorded before, but if you can’t find it you can simply run <code>boot2docker ip</code> to discover it (it’s usually <code>192.168.59.103</code>).</p>\n<h2 id=\"conclusions\" style=\"position:relative;\"><a href=\"#conclusions\" aria-label=\"conclusions permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusions</h2>\n<p>That’s only the very beginning with Docker, there are a bunch of other interesting features and approaches. I will probably write some other post while I will keep learning and using Docker, so stay tuned and write all your suggestions in the comments.</p>\n<p>Thank you</p>","frontmatter":{"title":"Simple echo server written in Go, dockerized!","slug":"simple-echo-server-written-in-go-dockerized","author":"Luciano Mammino","tags":["server","go","docker"],"date":"June 29, 2014","header_img":{"publicURL":"/static/d501b84eb19ffd911014f65477f60813/simple-echo-server-written-in-go-dockerized.jpg"}}}},"pageContext":{"slug":"simple-echo-server-written-in-go-dockerized","width":440,"height":220,"type":"twitter"}},"staticQueryHashes":[]}